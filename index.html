<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Sistema de Videovigilancia from Scratch</title>
    <meta name="description" content="">
    <meta name="author" content="Jesús Torres">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="./theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="./theme/bootstrap.min.css" rel="stylesheet">
    <link href="./theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="./theme/local.css" rel="stylesheet">
    <link href="./theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href=".">Sistema de Videovigilancia from Scratch</a>

        <div class="nav-collapse">
        <ul class="nav">
                    
                            <li><a href="./pages/acerca-de.html">Acerca de...</a></li>
                    <li><a href="./pages/seminarios.html">Seminarios</a></li>
                        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
                

        


    <div class='article'>
        <div class="content-title">
            <a href="./capturando-secuencias-de-video-qt.html"><h1>Capturando secuencias de vídeo Qt</h1></a>
            mar 11 febrero 2014

by <a class="url fn" href="./author/jesus-torres.html" rel="author">Jesús Torres</a>
 


 
        </div>
        
        <div><p><a href="./proyecto-qt-framework-de-desarrollo-de-aplicaciones.html" title="Proyecto Qt">Qt</a> incluye el módulo <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qtmultimedia-index.html" title="Qt Multimedia">Qt Multimedia</a> para facilitar la manipulación de
contenidos multimedia. Entre otras cosas permite reproducir audio y vídeo y
capturar desde dispositivos de adquisición soportados por el sistema operativo.</p>
<p>Como por defecto no viene activado es necesaro abrir el archivo <code>.pro</code> del
proyecto y añadir la línea</p>
<div class="codehilite"><pre><span class="n">QT</span>       <span class="o">+=</span> <span class="n">multimedia</span> <span class="n">multimediawidgets</span>
</pre></div>


<h2>Primeros pasos con la webcam</h2>
<p>Capturar de una webcam es tan sencillo como crear un objeto <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html" title="QCamera">QCamera</a> e iniciar
la captura mediante el método <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html" title="QCamera">QCamera</a>::<a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html#start" title="QCamera::start()">start</a>():</p>
<div class="codehilite"><pre><span class="n">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QCamera</span><span class="p">;</span>
<span class="n">camera</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">();</span>
</pre></div>


<p>Por lo general suele ser interesante incorporar un visor en el que mostrar
al usuario lo que la cámara está capturando. Para simplifcar esta tarea <a href="./proyecto-qt-framework-de-desarrollo-de-aplicaciones.html" title="Proyecto Qt">Qt</a>
nos ofrece el control <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcameraviewfinder.html" title="QCameraViewfinder">QCameraViewfinder</a> que hereda del más generico <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qvideowidget.html" title="QVideoWidget">QVideoWidget</a>:</p>
<div class="codehilite"><pre><span class="n">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QCamera</span><span class="p">;</span>
<span class="n">viewfinder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QCameraViewfinder</span><span class="p">;</span>
<span class="n">camera</span><span class="o">-&gt;</span><span class="n">setViewfinder</span><span class="p">(</span><span class="n">viewfinder</span><span class="p">);</span>
</pre></div>


<p>Como <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcameraviewfinder.html" title="QCameraViewfinder">QCameraViewfinder</a> —al igual que otros controles de <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qtmultimedia-index.html" title="Qt Multimedia">Qt Multimedia</a>— no
está disponible en Qt Designer, tendremos que colocarlo en nuestra ventana
desde el propio código. Por ejemplo, como el control central de la misma:</p>
<div class="codehilite"><pre><span class="n">viewfinder</span><span class="o">-&gt;</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">::</span><span class="n">Maximum</span><span class="p">);</span>
<span class="n">setCentralWidget</span><span class="p">(</span><span class="n">viewfinder</span><span class="p">);</span>
</pre></div>


<p><img src="http://qt-project.org/doc/qt-5/images/mainwindowlayout.png" alt="Organización de controles en la ventana principal" class="centered"></p>
<p>Hecho esto, finalmente podemos iniciar la cámara:</p>
<div class="codehilite"><pre><span class="c1">// camera-&gt;setCaptureMode(QCamera::CaptureVideo);</span>
<span class="n">camera</span><span class="o">-&gt;</span><span class="n">setCaptureMode</span><span class="p">(</span><span class="n">QCamera</span><span class="o">::</span><span class="n">CaptureViewfinder</span><span class="p">);</span>
<span class="n">camera</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">();</span>
</pre></div>


<h2>Acceder a un dispositivo específico</h2>
<p>En un mismo sistema pueden haber varios dispositivos de captura, de tal forma
que puede ser necesario crear un objeto <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html" title="QCamera">QCamera</a> para un dispositivo
concreto. En ese caso simplemente tenemos que indicarlo en el constructor:</p>
<div class="codehilite"><pre><span class="n">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QCamera</span><span class="p">(</span><span class="s">&quot;/dev/video0&quot;</span><span class="p">);</span>
</pre></div>


<p>Obviamente para hacerlo necesitamos conocer la lista de los dispositivos
disponibles en el sistema. Esto se puede hacer a través del método <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html" title="QCamera">QCamera</a>::<a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html#availableDevices" title="QCamera::availableDevices">availableDevices</a>(). Al igual que se puede obtener para cada uno de ellos un
texto más descriptivo para los usuarios usando <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html" title="QCamera">QCamera</a>::<a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html#deviceDescription" title="QCamera::deviceDescription">deviceDescription</a>().</p>
<div class="codehilite"><pre><span class="n">QList</span><span class="o">&lt;</span><span class="n">QByteArray</span><span class="o">&gt;</span> <span class="n">devices</span> <span class="o">=</span> <span class="n">QCamera</span><span class="o">::</span><span class="n">availableDevices</span><span class="p">();</span>
<span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Usando &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">QCamera</span><span class="o">::</span><span class="n">deviceDescription</span><span class="p">(</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QCamera</span><span class="p">(</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>


<h2>Accediendo a los frames individualmente</h2>
<p>Si estamos interesados en procesar los <em>frames</em> capturados, la forma más sencilla
—aunque no la única— es crear nuestra propia clase <em>viewfinder</em>. El método
<a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html" title="QCamera">QCamera</a>::<a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html#setViewfinder" title="QCamera::setViewfinder()">setViewfinder</a>() admite un puntero a objetos de la clase <a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qabstractvideosurface.html" title="QAbstractVideoSurface">QAbstractVideoSurface</a>, por lo que es de esa clase de la que debemos heredar
la nuestra:</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">MyVideoSurface</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QAbstractVideoSurface</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="nl">public:</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QVideoFrame</span><span class="o">::</span><span class="n">PixelFormat</span><span class="o">&gt;</span> <span class="n">supportedPixelFormats</span><span class="p">(</span>
        <span class="n">QAbstractVideoBuffer</span><span class="o">::</span><span class="n">HandleType</span> <span class="n">handleType</span> <span class="o">=</span>
            <span class="n">QAbstractVideoBuffer</span><span class="o">::</span><span class="n">NoHandle</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">// Indicar los formatos que soportamos</span>
        <span class="n">QList</span><span class="o">&lt;</span><span class="n">QVideoFrame</span><span class="o">::</span><span class="n">PixelFormat</span><span class="o">&gt;</span><span class="p">()</span> <span class="n">formats</span><span class="p">;</span>
        <span class="n">formats</span> <span class="o">&lt;&lt;</span> <span class="n">QVideoFrame</span><span class="o">::</span><span class="n">Format_RGB565</span><span class="p">;</span>
        <span class="n">formats</span> <span class="o">&lt;&lt;</span> <span class="n">QVideoFrame</span><span class="o">::</span><span class="n">Format_RGB555</span><span class="p">;</span>
        <span class="n">formats</span> <span class="o">&lt;&lt;</span> <span class="n">QVideoFrame</span><span class="o">::</span><span class="n">Format_RGB24</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">formats</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">present</span><span class="p">(</span><span class="k">const</span> <span class="n">QVideoFrame</span> <span class="o">&amp;</span><span class="n">frame</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Aquí el código para manipular el frame...</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>


<p>De tal forma que sólo tenemos que instanciarla y configurarla como visor de
nuestra cámara.</p>
<div class="codehilite"><pre><span class="n">MyVideoSurface</span> <span class="o">*</span><span class="n">videoSurface</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyVideoSurface</span><span class="p">;</span>
<span class="n">camera</span><span class="o">-&gt;</span><span class="n">setViewfinder</span><span class="p">(</span><span class="n">videoSurface</span><span class="p">);</span>
</pre></div>


<h2>Referencias</h2>
<ol>
<li><a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qtmultimedia-index.html" title="Qt Multimedia">Qt Multimedia</a></li>
<li><a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/qcamera.html" title="QCamera">QCamera</a> Class Reference.</li>
<li><a href="http://qt-project.org/doc/qt-5.0/qtmultimedia/videooverview.html">Video Overview</a></li>
</ol></div>
        <hr />
    </div>
		
    
 
        

 

    <div class='article'>
        <a href="./almacenar-datos-en-sqlite.html"><h2>Almacenar datos en SQLite</h2></a>
        <div class= "well small"> mié 11 septiembre 2013

by <a class="url fn" href="./author/jesus-torres.html" rel="author">Jesús Torres</a>
 


 </div>
        <div class="summary"><p>Muchos de los sistemas de gestión de bases de datos relacionales más conocidos
son de arquitectura cliente-servidor —por ejemplo MySQL, PostgreSQL u Oracle—.
Es decir, que están compuestos por un programa servidor —que es quien tiene
acceso local a los datos— de forma que uno o más programas cliente pueden ...</p> <a class="btn btn-info xsmall" href="./almacenar-datos-en-sqlite.html">leer más</a></div>
    </div>	
				
    
 
        

 

    <div class='article'>
        <a href="./servicios-y-demonios-en-linux.html"><h2>Servicios y demonios en Linux</h2></a>
        <div class= "well small"> sáb 18 mayo 2013

by <a class="url fn" href="./author/jesus-torres.html" rel="author">Jesús Torres</a>
 


 </div>
        <div class="summary"><p>Un <a href="http://es.wikipedia.org/wiki/Demonio_(inform%C3%A1tica)" title="Demonio (informática)">demonio</a><sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup> o servicio es un programa que se ejecuta en segundo plano,
fuera del control interactivo de los usuarios del sistema ya que carecen de
interfaz con estos.</p>
<p>El sistema generalmente inicia los demonios durante el arranque, siendo las
funciones más comunes de estos las de ofrecer servicios ...</p> <a class="btn btn-info xsmall" href="./servicios-y-demonios-en-linux.html">leer más</a></div>
    </div>	
				
            <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Anterior</a></li>

    <li class="active"><a href="./index.html">1</a></li>
    <li class=""><a href="./index2.html">2</a></li>
    <li class=""><a href="./index3.html">3</a></li>
    <li class=""><a href="./index4.html">4</a></li>
    <li class=""><a href="./index5.html">5</a></li>
    <li class=""><a href="./index6.html">6</a></li>
    <li class=""><a href="./index7.html">7</a></li>
    <li class=""><a href="./index8.html">8</a></li>
    <li class=""><a href="./index9.html">9</a></li>

    <li class="next"><a href="./index2.html">Next &rarr;</a></li>

</ul>
</div>    
 
  
        </div>
        
        <div class="span3">

            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Sitio
                </li>
            
                <li><a href="./archives.html">Archivos</a>
                <li><a href="./tags.html">Etiquetas</a>
                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml" rel="alternate">Fuente Atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml" rel="alternate">Fuente RSS</a></li>
                            </ul>
            </div>


                        <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categorias
                </li>
                
                                <li><a href="./category/comunicaciones.html">Comunicaciones</a></li>
                                <li><a href="./category/desarrollo.html">Desarrollo</a></li>
                                <li><a href="./category/hardware.html">Hardware</a></li>
                                <li><a href="./category/linux.html">Linux</a></li>
                                <li><a href="./category/overviews.html">Overviews</a></li>
                                <li><a href="./category/qt.html">Qt</a></li>
                                <li><a href="./category/vision.html">Visión</a></li>
                                   
            </ul>
            </div>
            

            

                        <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                                <li><a href="http://github.com/ull-etsii-sistemas-operativos/">github</a></li>
                                <li><a href="http://plus.google.com/u/0/communities/112085352199958768374">google+</a></li>
                                <li><a href="http://flattr.com/thing/1171169/Sistema-de-videovigilancia-from-scratch">flattr</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml">atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml">rss</a></li>
                            </ul>
            </div>
            </div>
            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
<ul class="nav nav-list">
    <li class="nav-header">
    Búsqueda de Google
    </li>

    <script type="text/javascript">
    (function() {
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.es/cse/cse.js?cx=' + '013894742475483232300:q2-5a1zlira';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search>Cargando...</gcse:search>
</ul>
</div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es"><img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a><br />Este obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es">Licencia Creative Commons Atribución 3.0 Unported</a>.</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
 
</body>
</html>