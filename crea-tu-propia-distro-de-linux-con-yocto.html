<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Crea tu propia distro de Linux con Yocto - Sistema de Videovigilancia from Scratch</title>
    <meta name="description" content="">
    <meta name="author" content="Jesús Torres">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="./theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="./theme/bootstrap.min.css" rel="stylesheet">
    <link href="./theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="./theme/local.css" rel="stylesheet">
    <link href="./theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href=".">Sistema de Videovigilancia from Scratch</a>

        <div class="nav-collapse">
        <ul class="nav">
                    
                            <li><a href="./pages/acerca-de.html">Acerca de...</a></li>
                    <li><a href="./pages/seminarios.html">Seminarios</a></li>
                        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
            <div class='article'>
        <div class="content-title">
            <h1>Crea tu propia distro de Linux con Yocto</h1>
            mar 22 enero 2013

by <a class="url fn" href="./author/jesus-torres.html" rel="author">Jesús Torres</a>
 


        </div>
	
        <div><p>El objetivo de este artículo es explicar paso a paso como se puede utilizar
el proyecto <a href="./yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Yocto</a> para crear nuestra propia distribución de Linux. Primero
construiremos una para ejecutarla en <a href="http://wiki.qemu.org/" title="QEMU">QEMU</a> y después otra para nuestra
Raspberry Pi.</p>
<h2>Inicio rápido</h2>
<p>El inicio rápido con el proyecto <a href="./yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Yocto</a> está perfectamente documentado en
<a href="http://www.yoctoproject.org/docs/1.0/yocto-quick-start/yocto-project-qs.html" title="Yocto Project Quick Start">Yocto Project Quick Start</a>. En cualquier caso aquí resumiremos los pasos
deteniéndonos en los de mayor importancia.</p>
<h3>Requisitos</h3>
<ul>
<li><strong>Una distribución de Linux.</strong> En nuestro caso, por simplicidad, cualquiera
de las basadas en Debian.</li>
<li>
<p><strong>Paquetes de desarrollo.</strong> En el sistema deben estar instalados una serie
de paquetes utilizados habitualmente en tareas de desarrollo. En un sistema
basado en Debian deberían poder instalarse con el siguiente comando:</p>
<div class="codehilite"><pre><span class="nv">$ </span>sudo apt-get install sed wget cvs subversion git-core <span class="se">\</span>
coreutils unzip texi2html texinfo libsdl1.2-dev docbook-utils <span class="se">\</span>
gawk python-pysqlite2 diffstat help2man make gcc <span class="se">\</span>
build-essential g++ desktop-file-utils chrpath libgl1-mesa-dev <span class="se">\</span>
libglu1-mesa-dev mercurial autoconf automake groff
</pre></div>


</li>
<li>
<p><strong>Una versión del proyecto <a href="./yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Yocto</a>.</strong> Las distintas versiones pueden
descargarse desde la dirección:</p>
<p><a href="http://downloads.yoctoproject.org/releases/yocto/">http://downloads.yoctoproject.org/releases/yocto/</a></p>
</li>
</ul>
<h3>Construir una imagen de sistema Linux</h3>
<p>El proceso de construir una imagen genera una distribución de Linux completa,
incluyendo las herramienta de desarrollo para la misma:</p>
<ol>
<li>
<p>Descargar el sistema de construcción <a href="./yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Poky</a> de la última versión del
proyecto <a href="./yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Yocto</a> y descomprimirla:</p>
<div class="codehilite"><pre><span class="nv">$ </span>wget http://downloads.yoctoproject.org/releases/yocto/yocto-1.3/poky-danny-8.0.tar.bz2
<span class="nv">$ </span>tar jxf poky-danny-8.0.tar.bz2
</pre></div>


</li>
<li>
<p>Crear el directorio <code>raspberry-pi-build</code> donde construir la imagen y
configurar las variables de entorno necesarias:</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">source </span>poky-danny-8.0/oe-init-build-env raspberry-pi-build
</pre></div>


<p>Como las variables de entorno configuradas por este comando se pierden al
 cerrar la shell, en caso de que eso ocurra o de abandonar la sesión sería
 necesario volver a ejecutar este comando antes de continuar.</p>
</li>
<li>
<p>Construir la imagen:</p>
<div class="codehilite"><pre><span class="nv">$ </span>bitbake core-image-minimal
</pre></div>


</li>
</ol>
<p>La imagen construida puede ejecutarse en <a href="http://wiki.qemu.org/" title="QEMU">QEMU</a> de la siguiente manera:</p>
<div class="codehilite"><pre><span class="nv">$ </span>runqemu qemux86
</pre></div>


<p>Y en unos segundos tendremos acceso a la consola de nuestra nueva distribución.</p>
<h3>Optimizando la construcción</h3>
<p>En el archivo <code>conf/local.conf</code> del directorio <code>raspberry-pi-build</code> se pueden
definir algunos parámetros que pueden reducir el tiempo necesario para
construir la imagen si se dispone de un sistema multi-núcleo.</p>
<p>Si se tienen <code>N</code> núcleos, es conveniente descomentar las variables <code>BB_NUMBER_THREADS</code>
y <code>PARALLEL_MAKE</code> y asignarle <code>N + 1</code>. Por ejemplo, con 8 núcleos el valor
debería ser 9:</p>
<div class="codehilite"><pre><span class="n">BB_NUMBER_THREADS</span> <span class="o">=</span> <span class="s">&quot;9&quot;</span>
<span class="n">PARALLEL_MAKE</span> <span class="o">=</span> <span class="s">&quot;-j 9&quot;</span>
</pre></div>


<h2>Crear una distribución para Raspberry Pi</h2>
<p>El ejemplo estándar del proyecto <a href="./yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Yocto</a> se construye por defecto para la arquitectura
<strong>qemux86</strong>. En el caso de querer compilar para otro sistema sólo es necesario añadir
una capa que incorpore los archivos de configuración necesarios.</p>
<p>En nuestro caso dicha capa es <strong>meta-raspberrypi</strong>, una capa <a href="http://en.wikipedia.org/wiki/Board_support_package" title="Board Support Package">BSP</a> que agrupa todos los
metadatos necesarios para construir para dispositivos Raspberry Pi. Fundamentalmente
contiene configuraciones para el núcleo y opciones para la arquitectura.</p>
<p>Estos son los pasos para incorporarla a nuestro proyecto:</p>
<ol>
<li>
<p>Clonar localmente el repositorio <strong>meta-raspberrypi</strong> fuera del directorio
<code>raspberry-pi-build</code>.</p>
<div class="codehilite"><pre><span class="nv">$ </span>git clone https://github.com/djwillis/meta-raspberrypi.git
</pre></div>


</li>
<li>
<p>Cambiar a la rama <strong>danny</strong> que es la de la versión de <a href="./yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Poky</a> que estamos usando:</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd </span>meta-raspberrypi
<span class="nv">$ </span>git checkout danny
</pre></div>


</li>
<li>
<p>Buscar la variable <code>BBLAYERS</code> en <code>raspberry-pi-build/conf/bblayers.conf</code> y añadir
al final la ruta hasta el repositorio de la capa <strong>meta-raspberrypi</strong> para incluirla
en el proceso de construcción. Por ejemplo:</p>
<div class="codehilite"><pre><span class="n">BBLAYERS</span> <span class="o">?=</span> <span class="s">&quot; \</span>
<span class="s">  /home/usuario/poky-danny-8.0/meta \</span>
<span class="s">  /home/usuario/poky-danny-8.0/meta-yocto \</span>
<span class="s">  /home/usuario/poky-danny-8.0/meta-yocto-bsp \</span>
<span class="s">  /home/usuario/meta-raspberry-pi \</span>
<span class="s">&quot;</span>
</pre></div>


</li>
<li>
<p>Buscar la variable <code>MACHINE</code> en <code>raspberry-pi-build/conf/local.conf</code> e indicar que
la máquina de destino de la imagen es <code>raspberrypi</code></p>
<div class="codehilite"><pre><span class="n">MACHINE</span> <span class="o">?=</span> <span class="s">&quot;raspberrypi&quot;</span>
</pre></div>


</li>
<li>
<p>Construir la imagen:</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="nb">cd </span>raspberry-pi-build
<span class="nv">$ </span>bitbake rpi-basic-image
</pre></div>


<p>Esta imagen incluye un servidor <strong>SSH</strong> y un <em>splash</em> de Raspberry Pi durante el arranque.
Mientras que la imagen alternativa <code>rpi-hwup-image</code> no contiene ninguna de las dos cosas.</p>
</li>
<li>
<p>Transferir la imagen construida a la tarjeta SD.</p>
<div class="codehilite"><pre><span class="nv">$ </span>sudo dd <span class="k">if</span><span class="o">=</span>tmp/deploy/images/rpi-basic-image-raspberrypi.rpi-sdimg <span class="nv">of</span><span class="o">=</span>/ruta/a/la/sd
</pre></div>


<p>y probarla en el dispositivo.</p>
</li>
</ol>
<h2>Referencias</h2>
<ol>
<li><a href="http://www.yoctoproject.org/docs/1.0/yocto-quick-start/yocto-project-qs.html">Yocto Project Quick Start</a>.</li>
<li><a href="http://pokylinux.org/doc/poky-handbook.html">Poky HandBook</a>.</li>
<li><a href="http://www.pimpmypi.com/blog/blogPost.php?blogPostID=7">Build a Custom Raspberry Pi Distro with OpenEmbedded &amp; Yocto</a>.</li>
</ol></div>
	
        <hr>
    	   
        <h2>Comentarios</h2>
			    <div class="g-comments-for z13agjmr0tazhfwft22egliyvmyrubrkf"></div>
    <script src="https://github.com/timrwood/moment/raw/1.7.2/min/moment.min.js"></script>
    <script src="./theme/pluscomments.js"></script>
    <script type="text/javascript">
    function pluscommentsLoad() { pluscomments.load('AIzaSyClPfZd7RRcX9e3eYiOLV__FyRO9RmJzmg'); }
    </script>
    <script src="https://apis.google.com/js/client.js?onload=pluscommentsLoad"></script>
    </div>
        </div>
        
        <div class="span3">

            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Sitio
                </li>
            
                <li><a href="./archives.html">Archivos</a>
                <li><a href="./tags.html">Etiquetas</a>
                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml" rel="alternate">Fuente Atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml" rel="alternate">Fuente RSS</a></li>
                            </ul>
            </div>


                        <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categorias
                </li>
                
                                <li><a href="./category/comunicaciones.html">Comunicaciones</a></li>
                                <li><a href="./category/desarrollo.html">Desarrollo</a></li>
                                <li><a href="./category/hardware.html">Hardware</a></li>
                                <li><a href="./category/linux.html">Linux</a></li>
                                <li><a href="./category/overviews.html">Overviews</a></li>
                                <li><a href="./category/qt.html">Qt</a></li>
                                <li><a href="./category/vision.html">Visión</a></li>
                                   
            </ul>
            </div>
            

            

                        <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                                <li><a href="http://github.com/ull-etsii-sistemas-operativos/">github</a></li>
                                <li><a href="http://plus.google.com/u/0/communities/112085352199958768374">google+</a></li>
                                <li><a href="http://flattr.com/thing/1171169/Sistema-de-videovigilancia-from-scratch">flattr</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml">atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml">rss</a></li>
                            </ul>
            </div>
            </div>
            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
<ul class="nav nav-list">
    <li class="nav-header">
    Búsqueda de Google
    </li>

    <script type="text/javascript">
    (function() {
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.es/cse/cse.js?cx=' + '013894742475483232300:q2-5a1zlira';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search>Cargando...</gcse:search>
</ul>
</div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es"><img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a><br />Este obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es">Licencia Creative Commons Atribución 3.0 Unported</a>.</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
 
</body>
</html>