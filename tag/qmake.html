<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>qmake - Sistema de Videovigilancia from Scratch</title>
    <meta name="description" content="">
    <meta name="author" content="Jesús Torres">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="../theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="../theme/local.css" rel="stylesheet">
    <link href="../theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="..">Sistema de Videovigilancia from Scratch</a>

        <div class="nav-collapse">
        <ul class="nav">
                    
                            <li><a href="../pages/acerca-de.html">Acerca de...</a></li>
                    <li><a href="../pages/seminarios.html">Seminarios</a></li>
                        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
                

        


    <div class='article'>
        <div class="content-title">
            <a href="../make-install-con-qmake.html"><h1>Make install con qmake</h1></a>
            lun 22 abril 2013

by <a class="url fn" href="../author/jesus-torres.html" rel="author">Jesús Torres</a>
 


 
        </div>
        
        <div><p>Cada entorno de desarrollo y/o lenguaje de programación maneja por sus propios
medios la manera de definir un proyecto de software y el proceso de construcción
del mismo. Sin embargo <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> sigue siendo ámpliamente utilizado para este
propósito, especialmente en los sistemas UNIX y derivados.</p>
<h1>Make</h1>
<p>Para usar <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> cada proyecto debe ir acompañado de un fichero <code>Makefile</code> donde
se incluyen las reglas para la compilación y enlazado de las librerías y
ejecutables del mismo. Estas reglas fijan que es lo que hay que hacer —que
comandos ejecutar y como hacerlo— para obtener cada producto del proceso de
construcción, así como las dependencias de estos con respecto a otros productos
o a los distintos archivos de código fuente del proyecto. Además se pueden
incluir reglas para automatizar tareas tales como generar la documentación;
instalar o desplegar los programas, las librerías, la documentación y otros
productos generados; o limpiar el proyecto, borrando archivos temporales y
subproductos de la compilación.</p>
<p>Cuando la construcción de un proyecto ha sido automatizada adecuadamente con
<code>make</code>, la compilación del mismo se reduce a ejecutar el comando:</p>
<div class="codehilite"><pre><span class="nv">$ </span>make
</pre></div>


<p>en el directorio del proyecto. Siendo su instalación igual de sencilla:</p>
<div class="codehilite"><pre><span class="nv">$ </span>make install
</pre></div>


<p>Obviamente entornos integrados de desarrollo como Eclise, KDevelop, Code::Blocks
o Visual Studio incorporan sus propias herramientas para automatizar la
compilación de proyectos, que además se integran perfectamente con estos
entornos gráficos. Sin embargo <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> suele estar disponible en cualquier
sistema y puede ser utilizado independientemente de las preferencias de cada
desarrollador acerca del entorno integrado con el que trabajar.</p>
<p>Además <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> es una herramienta que fácilmente puede ser utilizada desde otras
de más alto nivel. Por ejemplo, un sistema de construcción de paquetes como el
que utilizan las distribuciones basadas en Debian automatiza todos los pasos,
desde la descarga del código fuente hasta la generación del archivo <code>.deb</code>,
pasando por invocar a <code>make</code> para compilar y a <code>make install</code> para que los
productos de dicha construcción se instalen en su ubicación definitiva<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>, de
donde son tomados para conformar el contenido del paquete del proyecto. De forma
muy similar funciona <a href="../yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Bitbake</a>, la herramienta de construcción que utiliza el
proyecto <a href="../yocto-poky-y-bitbake.html" title="Yocto, Poky y BitBake">Yocto</a> para generar distribuciones de Linux para sistemas empotrados,
y así una larga lista de herramientas similares. Para todas ellas el poder
automatizar la construcción de proyectos de software es fundamental, siendo éste
un campo donde la solución orientada a línea de comandos de <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> se muestra
mucho más flexible que las soluciones de interfaz gráfica integradas de los 
distintos entornos de desarrollo.</p>
<h1>Qmake</h1>
<p>Aunque <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> es una herramienta muy flexible, resulta muy compleja de utilizar,
si no imposible, cuando se quiere crear software portable. Diferentes sistemas
operativos pueden tener distintos compiladores, ya sean de diferentes
fabricantes o en distintas versiones, u ofrecer a las aplicaciones diferentes
funcionalidades —o las mismas pero de manera distintas—. Además un proyecto de
software puede depender de otras librerías o programas, que nuevamente pueden
ser de versiones diferentes o distintos desarrolladores. Y a todo eso hay que
unir que según el sistema operativo la ubicación de librerías, programas y
herramientas de desarrollo puede diferir.</p>
<p>Enfrentar estas situaciones con <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> es extremadamente difícil, por lo que los
desarrolladores suelen utilizar otras utilidades que se encarguen de buscar las
herramientas de desarrollo y las dependencias del programa, detectar las
funcionalidades del sistema y generar un archivo <code>Makefile</code> ajustado al sistema
concreto donde se va a compilar.</p>
<p>Herramientas de este tipo existen muchas. Por ejemplo Autotools<sup id="fnref:2"><a class="footnote-ref" href="#fn:2" rel="footnote">2</a></sup>, CMake,
SCons y <a href="http://en.wikipedia.org/wiki/Qmake" title="qmake">qmake</a>. Siendo esta última la que se usa preferentemente con las
aplicaciones desarrolladas en <a href="../proyecto-qt-framework-de-desarrollo-de-aplicaciones.html" title="Proyecto Qt">Qt</a>, ya que sabe manejar perfectamente las
singularidades de este <em>framework</em>.</p>
<p>Con <a href="http://en.wikipedia.org/wiki/Qmake" title="qmake">qmake</a> las información requerida para construir un proyecto se define en un
<a href="http://qt-project.org/doc/qt-5.0/qtdoc/qmake-project-files.html" title="qmake Project Files">archivo de proyecto</a> que generalmente tienen extensión <code>.pro</code>. Al ejecutar
<code>qmake</code> dentro del directorio de un proyecto, éste interpreta los archivos de
proyecto y genera el <code>Makefile</code> correspondiente. Después sólo es necesario
ejecutar el comando <code>make</code> para iniciar la compilación del mismo:</p>
<div class="codehilite"><pre><span class="nv">$ </span>qmake
<span class="nv">$ </span>make
<span class="nv">$ </span>make install
</pre></div>


<h1>Reglas para make install</h1>
<p>Realmente el último <code>make install</code> no sirve de mucho porque <a href="http://en.wikipedia.org/wiki/Qmake" title="qmake">qmake</a> por defecto
no añade tareas a dicha regla en el archivo <code>Makefile</code>.</p>
<p>Si queremos que al ejecutar <code>make install</code> se instalen los archivos de nuestra
aplicación en las ubicaciones adecuadas<sup id="fnref:3"><a class="footnote-ref" href="#fn:3" rel="footnote">3</a></sup>, debemos instruir a <a href="http://en.wikipedia.org/wiki/Qmake" title="qmake">qmake</a> a través
del <a href="http://qt-project.org/doc/qt-5.0/qtdoc/qmake-project-files.html" title="qmake Project Files">archivo de proyecto</a> acerca de como se hace:</p>
<div class="codehilite"><pre>unix {          # Esta configuración específica de Linux y UNIX
    # Variables
    #
    isEmpty(PREFIX) {
        PREFIX = /usr/local
    }
    BINDIR  = $$PREFIX/bin
    DATADIR = $$PREFIX/share
    CONFDIR = /etc
    isEmpty(VARDIR) {
        VARDIR  = /var/lib/$${TARGET}
    }

    # Install
    #
    INSTALLS += target config desktop icon32 vardir

    ## Instalar ejecutable
    target.path = $$BINDIR

    ## Instalar archivo de configuración
    config.path = $$CONFDIR
    config.files += $${TARGET}.ini

    ## Instalar acceso directo en el menú del escritorio
    desktop.path = $$DATADIR/applications
    desktop.files += $${TARGET}.desktop

    ## Instalar icono de aplicación
    icon32.path = $$DATADIR/icons/hicolor/32x32/apps
    icon32.files += ./data/32x32/$${TARGET}.png

    ## Crear directorio de archivos variables
    vardir.path = $$VARDIR
    vardir.commands = :
}
</pre></div>


<p>La variable <code>INSTALLS</code> debe contener una lista de los recursos que queremos que
sean instalados con <code>make install</code>. De tal forma que cada elemento de la lista
incorpora atributos que proporcionan información sobre dónde van a ser
instalados.</p>
<p>Por ejemplo, el elemento <code>target</code> representa a los ficheros resultado de la
construcción del proyecto. Asignando una ruta a <code>target.path</code> estamos indicando
donde queremos que sean instalados. De forma similar, el elemento <code>icon32</code>
representa al icono de la aplicación en el escritorio. Asignando un valor a
<code>icon32.path</code> estamos diciendo donde queremos que sea instalado, mientras que el
valor del atributo <code>icon32.files</code> indica donde podemos encontrar el archivo o
archivos del icono respecto al directorio del proyecto.</p>
<h1>Definición de macros del preprocesador</h1>
<p>Las variables que hemos definido dentro del <a href="http://qt-project.org/doc/qt-5.0/qtdoc/qmake-project-files.html" title="qmake Project Files">archivo de proyecto</a> establecen la
ubicación de los recursos del programa tras su instalación. Sería más complicado
cometer errores si en nuestro código fuente usáramos directamente las rutas tal
y como se definen en el <a href="http://qt-project.org/doc/qt-5.0/qtdoc/qmake-project-files.html" title="qmake Project Files">archivo de proyecto</a>, sin tener que volver a definirlas
en C++. Además eso daría pie a modificar la ruta de los archivos mediante la
redefinición de variables en la línea de comandos de <a href="http://en.wikipedia.org/wiki/Qmake" title="qmake">qmake</a>, sin tener por ello
que modificar el código fuente. Por ejemplo:</p>
<div class="codehilite"><pre><span class="nv">$ </span>qmake <span class="nv">PREFIX</span><span class="o">=</span>/usr
</pre></div>


<p>ejecuta <a href="http://en.wikipedia.org/wiki/Qmake" title="qmake">qmake</a> usando el valor indicado para la variable <code>PREFIX</code>.</p>
<p>Para conseguir esto sólo tenemos que utilizar la variable <code>DEFINES</code>, que nos
permite listar un conjunto de macros del preprocesador<sup id="fnref:4"><a class="footnote-ref" href="#fn:4" rel="footnote">4</a></sup> que queremos que sean
pasadas al compilador.</p>
<div class="codehilite"><pre>unix {          # Esta configuración específica de Linux y UNIX
    # Variables
    #
    isEmpty(PREFIX) {
        PREFIX = /usr/local
    }
    BINDIR  = $$PREFIX/bin
    DATADIR = $$PREFIX/share
    CONFDIR = /etc
    isEmpty(VARDIR) {
        VARDIR  = /var/lib/$${TARGET}
    }

    DEFINES += APP_DATADIR=\\\&quot;$$DATADIR\\\&quot;
    DEFINES += APP_VARDIR=\\\&quot;$$VARDIR\\\&quot;
    DEFINES += APP_CONFFILE=\\\&quot;$$CONFDIR/$${TARGET}.ini\\\&quot;

    # Install
    #
    INSTALLS += target config desktop icon32 vardir

    ## Instalar ejecutable
    target.path = $$BINDIR

    ## Instalar archivo de configuración
    config.path = $$CONFDIR
    config.files += $${TARGET}.ini

    ## Instalar acceso directo en el menú del escritorio
    desktop.path = $$DATADIR/applications
    desktop.files += $${TARGET}.desktop

    ## Instalar icono de aplicación
    icon32.path = $$DATADIR/icons/hicolor/32x32/apps
    icon32.files += ./data/32x32/$${TARGET}.png

    ## Crear directorio de archivos variables
    vardir.path = $$VARDIR
    vardir.commands = :
}
</pre></div>


<p>Así, por ejemplo, dentro del código fuente se puede usar la macro <code>APP_CONFFILE</code>
con la ruta al archivo de configuración de la aplicación para acceder a él
mediante <a href="http://qt-project.org/doc/qt-5.0/qtcore/qsettings.html" title="QSettings">QSettings</a>:</p>
<div class="codehilite"><pre><span class="n">QSettings</span> <span class="nf">settings</span><span class="p">(</span><span class="n">APP_CONFFILE</span><span class="p">,</span> <span class="n">QSettings</span><span class="o">::</span><span class="n">IniFormat</span><span class="p">);</span>
</pre></div>


<h1>Referencias</h1>
<ol>
<li><a href="http://qt-project.org/doc/qt-5.0/qtdoc/qmake-project-files.html">qmake Project
Files</a></li>
<li>Wikipedia - <a href="http://es.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a></li>
</ol>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Durante el proceso de construcción de un paquete <code>.deb</code> el proyecto, una
vez compilado, se instala, pero no en la raíz del sistema donde está teniendo
lugar la compilación, sino que se confina el comando <code>make install</code> a un
subdirectorio temporal. Así <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a> deposita los archivos en sus ubicaciones
predefinidas (p. ej. <code>/usr/bin</code>, <code>/usr/lib</code>, <code>/etc</code>, <code>/var/lib</code>, etc.) solo que
relativas a dicho subdirectorio (p .ej. <code>/ruta/al/subdirectorio/usr/bin</code>,
<code>/ruta/al/subdirectorio/etc</code>, <code>/ruta/al/subdirectorio/usr/lib</code>,
<code>/ruta/al/subdirectorio/var/lib</code>, etc.). Para obtener el contenido del paquete
sólo hace falta tomar el contenido del subdirectorio temporal, evitando que el
proceso de construcción ensucie el sistema donde se está ejecutando.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>GNU Autotools es la herramienta que está detrás de tener que ejecutar
<code>./configure</code> antes de compilar muchos programas y librerías libres con <a href="&quot;http://es.wikipedia.org/wiki/Make&quot;" title="make">make</a>.&#160;<a class="footnote-backref" href="#fnref:2" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>En los sistemas Linux, UNIX y derivados éstas ubicaciones vienen definidas
por el <a href="http://es.wikipedia.org/wiki/Filesystem_Hierarchy_Standard" title="Filesystem Hierarchy Standard">Filesystem Hierarchy Standard</a>.&#160;<a class="footnote-backref" href="#fnref:3" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>Las macros del preprocesador son aquellas que generalmente se definen en
C/C++ mediante la directiva <code>#define</code>.&#160;<a class="footnote-backref" href="#fnref:4" rev="footnote" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
        <hr />
    </div>
		
            <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Anterior</a></li>

    <li class="active"><a href="../tag/qmake.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Siguiente</a></li>

</ul>
</div>    
 
  
        </div>
        
        <div class="span3">

            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Sitio
                </li>
            
                <li><a href="../archives.html">Archivos</a>
                <li><a href="../tags.html">Etiquetas</a>
                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml" rel="alternate">Fuente Atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml" rel="alternate">Fuente RSS</a></li>
                            </ul>
            </div>


                        <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categorias
                </li>
                
                                <li><a href="../category/comunicaciones.html">Comunicaciones</a></li>
                                <li><a href="../category/hardware.html">Hardware</a></li>
                                <li><a href="../category/linux.html">Linux</a></li>
                                <li><a href="../category/overviews.html">Overviews</a></li>
                                <li><a href="../category/qt.html">Qt</a></li>
                                <li><a href="../category/vision.html">Visión</a></li>
                                   
            </ul>
            </div>
            

            

                        <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                                <li><a href="http://github.com/ull-etsii-sistemas-operativos/">github</a></li>
                                <li><a href="http://plus.google.com/u/0/communities/112085352199958768374">google+</a></li>
                                <li><a href="http://flattr.com/thing/1171169/Sistema-de-videovigilancia-from-scratch">flattr</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml">atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml">rss</a></li>
                            </ul>
            </div>
            </div>
            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
<ul class="nav nav-list">
    <li class="nav-header">
    Búsqueda de Google
    </li>

    <script type="text/javascript">
    (function() {
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.es/cse/cse.js?cx=' + '013894742475483232300:q2-5a1zlira';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search>Cargando...</gcse:search>
</ul>
</div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es"><img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a><br />Este obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es">Licencia Creative Commons Atribución 3.0 Unported</a>.</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
 
</body>
</html>