<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>RIFF - Sistema de Videovigilancia from Scratch</title>
    <meta name="description" content="">
    <meta name="author" content="Jesús Torres">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="../theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="../theme/local.css" rel="stylesheet">
    <link href="../theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="..">Sistema de Videovigilancia from Scratch</a>

        <div class="nav-collapse">
        <ul class="nav">
                    
                            <li><a href="../pages/acerca-de.html">Acerca de...</a></li>
                    <li><a href="../pages/seminarios.html">Seminarios</a></li>
                        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
                

        


    <div class='article'>
        <div class="content-title">
            <a href="../resource-interchange-file-format.html"><h1>Resource Interchange File Format</h1></a>
            dom 12 mayo 2013

by <a class="url fn" href="../author/jesus-torres.html" rel="author">Jesús Torres</a>
 


 
        </div>
        
        <div><p>El <a href="http://en.wikipedia.org/wiki/Resource_Interchange_File_Format">Resource Interchange File Format</a> o <a href="http://en.wikipedia.org/wiki/Resource_Interchange_File_Format" title="Resource Interchange File Format">RIFF</a> es un formato contenedor genérico diseñado para almacenar datos en forma
de fragmentos etiquetados o <a href="http://en.wikipedia.org/wiki/Chunk_(information)" title="Chunk (information)">chunks</a>. Siendo usado en la actualidad como formato
contenedor de los conocidos formatos de archivo AVI, ANI y WAV de Microsoft, es
indudable que resulta especialmente útil para almacenar contenidos multimedia,
aunque realmente puede almacenar cualquier tipo de información.</p>
<h1>Tipos de fragmentos</h1>
<p>Hay dos tipos de fragmentos en un archivo <a href="http://en.wikipedia.org/wiki/Resource_Interchange_File_Format" title="Resource Interchange File Format">RIFF</a>. El más básico son los
<a href="http://en.wikipedia.org/wiki/Chunk_(information)" title="Chunk (information)">chunks</a> o fragmentos de datos propiamente dichos:</p>
<div class="codehilite"><pre><span class="k">struct</span> <span class="n">Chunk</span>
<span class="p">{</span>
    <span class="n">uint32_t</span> <span class="n">type</span><span class="p">;</span>
    <span class="n">uint32_t</span> <span class="n">size</span><span class="p">;</span>
    <span class="n">uint8_t</span>  <span class="n">data</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>        <span class="c1">// contiene datos en general</span>
<span class="p">};</span>
</pre></div>


<p>donde <code>type</code> sirve para identificar el tipo y el formato de los datos que
almacena el fragmento y <code>size</code> para especificar su tamaño —sin incluir ni el
tamaño del campo <code>type</code> ni el de <code>size</code>—.</p>
<p>El otro tipo de fragmento son las listas:</p>
<div class="codehilite"><pre><span class="k">struct</span> <span class="n">List</span>
<span class="p">{</span>
    <span class="n">uint32_t</span> <span class="n">type</span><span class="p">;</span>
    <span class="n">uint32_t</span> <span class="n">size</span><span class="p">;</span>
    <span class="n">uint32_t</span> <span class="n">listType</span><span class="p">;</span>
    <span class="n">uint8_t</span>  <span class="n">data</span><span class="p">[</span><span class="n">size</span><span class="o">-</span><span class="mi">4</span><span class="p">];</span>      <span class="c1">// contiene otros Chunk o List</span>
<span class="p">};</span>
</pre></div>


<p>que son aquellos que contienen una colección de otros fragmentos o listas:</p>
<ul>
<li>Las listas se identifican y distinguen de otros fragmentos porque su campo
<code>type</code> contiene o los 4 caracteres de <code>RIFF</code> o de <code>LIST</code><sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></li>
<li>Para este tipo de fragmentos el tamaño en el campo <code>size</code> incluye tanto el
 de los datos almacenados dentro del fragmento como el del campo <code>listType</code>.</li>
<li>Dentro de la lista los fragmentos que contiene se disponen unos detrás de
otros, pero siempre asegurando que cada fragmento comienza en una dirección
par —es decir, que se alinean a 16 bits—.</li>
</ul>
<p>El archivo contenedor en si mismo es una gran fragmento de lista tipo <code>RIFF</code> que
contiene otros fragmentos. Estos pueden ser <em>chunks</em> o listas de tipo <code>LIST</code>.
Por lo tanto en una archivo RIFF sólo existe una lista de este tipo, que hace
las veces de contenedor de todos los fragmentos del archivo. El valor del campo
<code>listType</code> del fragmento <code>RIFF</code> es una secuencia de 4 bytes que identifica el
formato del archivo y se lo conoce como el <a href="http://www.fourcc.org/codecs.php" title="FourCC">FourCC</a> del mismo.</p>
<h1>Estructura general</h1>
<p>Para hacernos una idea del formato este sería el esquema de un archivo AVI
convencional:</p>
<div class="codehilite"><pre>RIFF <span class="o">(</span><span class="s1">&#39;AVI &#39;</span>
      LIST <span class="o">(</span><span class="s1">&#39;hdr1&#39;</span>
            AVIH <span class="o">(</span>&lt;cabecera principal del AVI&gt;<span class="o">)</span>
            LIST <span class="o">(</span><span class="s1">&#39;str1&#39;</span>
                  STRH <span class="o">(</span>&lt;cabecera del flujo&gt;<span class="o">)</span>
                  STRF <span class="o">(</span>&lt;formato del flujo&gt;<span class="o">)</span>
                  ...
                 <span class="o">)</span>
            ...
           <span class="o">)</span>
      LIST <span class="o">(</span><span class="s1">&#39;movi&#39;</span>
            <span class="o">{</span>Chunk | LIST <span class="o">(</span><span class="s1">&#39;rec &#39;</span>
                           Chunk1
                           Chunk2
                           ...
                          <span class="o">)</span>
             ...
            <span class="o">}</span>
            ...
           <span class="o">)</span>
      <span class="o">[</span>IDX1 <span class="o">(</span>&lt;índice AVI&gt;<span class="o">)]</span>
     <span class="o">)</span>
</pre></div>


<p>Donde los identificadores en mayúsculas denotan el valor del campo <code>type</code> al
comienzo de un fragmento. Este siempre es seguido por el campo <code>size</code>, que no se
muestra en el esquema anterior. Por otro lado el valor de los campos <code>listType</code>
de los fragmentos de tipo lista se indica entre comillas simples.</p>
<p>Para observar una estructura real de archivo RIFF se puede utilizar el
programa <a href="http://manpages.ubuntu.com/manpages/lucid/man1/rifftree.1.html" title="Ubuntu Manpage: rifftree">rifftree</a> del paquete <code>gigtools</code> con cualquier archivo <code>.avi</code> o
<code>.wav</code> que tengamos a mano.</p>
<h1>Rifftree</h1>
<p>Para ilustrar lo comentado sobre los archivos RIFF, he publicado en GitHub <a href="http://github.com/aplatanado/rifftree">mi
propia versión de rifftree</a>. Está
desarrollada con <a href="../proyecto-qt-framework-de-desarrollo-de-aplicaciones.html" title="Proyecto Qt">Qt</a> y hace uso del mapeo de archivos en memoria para
facilitar el acceso al archivo RIFF.</p>
<h1>Referencias</h1>
<ol>
<li>Wikipedia - <a href="http://en.wikipedia.org/wiki/Resource_Interchange_File_Format">Resource Interchange File Format</a></li>
<li>MSDN - <a href="http://msdn.microsoft.com/en-us/library/ms779636(VS.85).aspx">AVI RIFF File Reference</a></li>
<li><a href="http://www.alexander-noe.com/video/documentation/avi.pdf">AVI File Format</a></li>
<li><a href="http://www.fourcc.org/codecs.php" title="FourCC">FourCC</a></li>
</ol>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Si bien en el archivo se almacenan los caracteres <code>'R'</code>, <code>'R'</code>, <code>'I'</code>, <code>'F'</code>
en ese orden, hay que tener en cuenta que al interpretarlo como <code>uint32_t</code> en
una máquina <em>little-endian</em> no veremos el número 0x52494646 sino 0x46464952.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
        <hr />
    </div>
		
            <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Anterior</a></li>

    <li class="active"><a href="../tag/riff.html">1</a></li>

    <li class="next disabled"><a href="#">&rarr; Siguiente</a></li>

</ul>
</div>    
 
  
        </div>
        
        <div class="span3">

            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Sitio
                </li>
            
                <li><a href="../archives.html">Archivos</a>
                <li><a href="../tags.html">Etiquetas</a>
                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml" rel="alternate">Fuente Atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml" rel="alternate">Fuente RSS</a></li>
                            </ul>
            </div>


                        <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categorias
                </li>
                
                                <li><a href="../category/comunicaciones.html">Comunicaciones</a></li>
                                <li><a href="../category/desarrollo.html">Desarrollo</a></li>
                                <li><a href="../category/hardware.html">Hardware</a></li>
                                <li><a href="../category/linux.html">Linux</a></li>
                                <li><a href="../category/overviews.html">Overviews</a></li>
                                <li><a href="../category/qt.html">Qt</a></li>
                                <li><a href="../category/vision.html">Visión</a></li>
                                   
            </ul>
            </div>
            

            

                        <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                                <li><a href="http://github.com/ull-etsii-sistemas-operativos/">github</a></li>
                                <li><a href="http://plus.google.com/u/0/communities/112085352199958768374">google+</a></li>
                                <li><a href="http://flattr.com/thing/1171169/Sistema-de-videovigilancia-from-scratch">flattr</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/atom.xml">atom</a></li>
                                <li><a href="http://ull-etsii-sistemas-operativos.github.io/videovigilancia-blog/feeds/rss.xml">rss</a></li>
                            </ul>
            </div>
            </div>
            
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
<ul class="nav nav-list">
    <li class="nav-header">
    Búsqueda de Google
    </li>

    <script type="text/javascript">
    (function() {
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.es/cse/cse.js?cx=' + '013894742475483232300:q2-5a1zlira';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
    })();
    </script>
    <gcse:search>Cargando...</gcse:search>
</ul>
</div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es"><img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a><br />Este obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.es">Licencia Creative Commons Atribución 3.0 Unported</a>.</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
 
</body>
</html>